<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>PostMessage</title>
</head>

<body>
<h1>Содержимое iframe</h1>

<div>
    <p>Полученное сообщение</p>
    <div id="message"></div>
</div>
<script>
    const onMessage = (evt) => {
        const data = evt.data;
        const origin = evt.origin;

        /**
         * Проверка октуда пришел запрос
         */
        if (origin !== "https://s.codepen.io") {
            alert(`Запрос пришел с другого домена`);
            return;
        }

        let str = `Пришли неверные данные`;

        if (data.title && data.value && data.method) {

            switch(data.method) {
                case `setItem`:
                    localStorage.setItem(data.title, data.value);
                    str = `Значение "${data.title}" записано в localStorage и равно "${localStorage.getItem(data.title)}"`;
                    break;
                case `getItem`:
                    localStorage.getItem(data.title);

                    str = `${window.parent}!!!!  Значение "${data.title}" из localStorage равно "${localStorage.getItem(data.title)}"`;

                    window.parent.postMessage(`hi codepen`, `https://s.codepen.io`);
                    break;
                case `removeItem`:
                    localStorage.removeItem(data.title);
                    str = `Значение ${data.title} Removed!!! из localStorage. "${localStorage.getItem(data.title)}"`;
                    break;

            }
        }

        document.getElementById(`message`).innerHTML = str;
    };

    if (typeof window.addEventListener != `undefined`) {
        window.addEventListener(`message`, onMessage, false);
    } else if (typeof window.attachEvent != `undefined`) {
        window.attachEvent(`onmessage`, onMessage);
    }
</script>
</body>

</html>
